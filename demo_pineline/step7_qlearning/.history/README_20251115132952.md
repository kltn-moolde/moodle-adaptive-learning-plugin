# ğŸ“ Adaptive Learning System - Q-Learning Recommendation Engine

**Version**: 2.0  
**Status**: âœ… Production Ready

## ğŸ“‹ Tá»•ng quan

Há»‡ thá»‘ng gá»£i Ã½ lá»™ trÃ¬nh há»c táº­p thÃ­ch á»©ng sá»­ dá»¥ng **Q-Learning**, Ä‘Æ°á»£c huáº¥n luyá»‡n tá»« dá»¯ liá»‡u mÃ´ phá»ng hÃ nh vi há»c sinh, phÃ¢n cá»¥m theo nÄƒng lá»±c há»c táº­p. Há»‡ thá»‘ng phÃ¢n tÃ­ch tráº¡ng thÃ¡i há»c táº­p hiá»‡n táº¡i cá»§a sinh viÃªn (cluster, module, tiáº¿n Ä‘á»™, Ä‘iá»ƒm sá»‘, hÃ nh Ä‘á»™ng gáº§n nháº¥t, tráº¡ng thÃ¡i stuck) Ä‘á»ƒ gá»£i Ã½ **top-K actions** tá»‘i Æ°u.

### âœ¨ TÃ­nh nÄƒng chÃ­nh

- **State 6D/7D**: Há»— trá»£ cáº£ 2 formats vá»›i auto-conversion (6D cho Q-table cÅ©, 7D cho training má»›i)
- **15 Actions**: Tá»« action space vá»›i time context (past/current/future)
- **37+ Learning Activities**: Tá»« course structure thá»±c táº¿
- **Cluster-Adaptive**: Chiáº¿n lÆ°á»£c reward khÃ¡c nhau cho tá»«ng cluster
- **LO Mastery Tracking**: Track vÃ  dá»± Ä‘oÃ¡n Ä‘iá»ƒm midterm dá»±a trÃªn Learning Outcomes
- **Intelligent Activity Selection**: Gá»£i Ã½ activity cá»¥ thá»ƒ dá»±a trÃªn LO yáº¿u vá»›i XAI explanations
- **LO Improvement Prediction**: Dá»± Ä‘oÃ¡n % cáº£i thiá»‡n LO sau khi hoÃ n thÃ nh activity
- **QTableAdapter**: Tá»± Ä‘á»™ng convert giá»¯a module IDs vÃ  action indices
- **REST API**: FastAPI vá»›i activity recommendations vÃ  explanations
- **Detailed Logging**: State transitions, reward breakdown, LO tracking

### ğŸ¯ Cáº£i tiáº¿n V2

| Metric | V1 | V2 | Cáº£i thiá»‡n |
|--------|----|----|-----------|
| **Q-table States** | 415 | 7,779+ | **18.7Ã—** â¬†ï¸ |
| **Coverage** | 1.2% | 18.2%+ | **15.2Ã—** â¬†ï¸ |
| **Training Episodes** | 500 | 1,000+ | **2Ã—** â¬†ï¸ |
| **State Dimensions** | ~10+ | 7 | ÄÆ¡n giáº£n hÆ¡n |
| **LO Integration** | âŒ | âœ… | Má»›i |

---

## ğŸš€ Quick Start

### 1. CÃ i Ä‘áº·t Dependencies

```bash
cd step7_qlearning
pip install -r requirements.txt
```

**Requirements:**
```
fastapi>=0.104.0
uvicorn>=0.24.0
numpy>=1.24.0
pandas>=2.0.0
scikit-learn>=1.3.0
matplotlib>=3.7.0
seaborn>=0.12.0
```

### 2. Training Model

```bash
# Training cÆ¡ báº£n
python3 train_qlearning.py --episodes 100 --students 5 --steps 30

# Training vá»›i detailed logging
python3 train_qlearning.py \
    --episodes 100 \
    --students 5 \
    --steps 30 \
    --detailed-logging \
    --log-interval 10
```

### 3. Khá»Ÿi Ä‘á»™ng API Server

```bash
# Development mode
uvicorn api_service:app --reload --port 8080

# Production mode
uvicorn api_service:app --host 0.0.0.0 --port 8080 --workers 4
```

### 4. Test API

```bash
# Health check
curl http://localhost:8080/api/health

# Get recommendations vá»›i LO mastery (optional)
curl -X POST http://localhost:8080/api/recommend \
  -H "Content-Type: application/json" \
  -d '{
    "student_id": 123,
    "features": {
      "cluster_id": 2,
      "current_module_id": 67,
      "module_progress": 0.75,
      "avg_score": 0.85,
      "recent_action_type": 1,
      "is_stuck": false
    },
    "lo_mastery": {
      "LO1.1": 0.4,
      "LO1.2": 0.35,
      "LO2.2": 0.25
    },
    "top_k": 3
  }'
```

### 5. Simulation

```bash
# Simulate learning path vá»›i trained model
python3 simulate_learning_path.py \
    --qtable models/qtable_best.pkl \
    --students 3 \
    --steps 30 \
    --verbose
```

---

## ğŸ“Š Cáº¥u trÃºc Dá»± Ã¡n

```
step7_qlearning/
â”œâ”€â”€ ğŸ“‚ core/                          # Core components
â”‚   â”œâ”€â”€ qlearning_agent_v2.py        # Q-Learning agent
â”‚   â”œâ”€â”€ state_builder_v2.py          # State builder (7D)
â”‚   â”œâ”€â”€ reward_calculator_v2.py      # Cluster-adaptive rewards + LO tracking
â”‚   â”œâ”€â”€ action_space.py              # Action definitions (15 actions)
â”‚   â”œâ”€â”€ activity_recommender.py      # Intelligent activity selection
â”‚   â”œâ”€â”€ lo_mastery_tracker.py       # LO mastery tracking & midterm prediction
â”‚   â”œâ”€â”€ learning_path_simulator.py   # Complete simulation system
â”‚   â”œâ”€â”€ state_transition_logger.py   # Detailed logging
â”‚   â””â”€â”€ student.py                   # Student model
â”‚
â”œâ”€â”€ ğŸ“‚ services/                      # Services
â”‚   â”œâ”€â”€ model_loader.py              # Load models
â”‚   â”œâ”€â”€ cluster_service.py           # Cluster prediction
â”‚   â”œâ”€â”€ qtable_service.py            # Q-table inspection
â”‚   â””â”€â”€ recommendation_service.py   # Recommendation engine
â”‚
â”œâ”€â”€ ğŸ“‚ models/                        # Trained models
â”‚   â””â”€â”€ qtable_best.pkl             # V2 model (7,779+ states) â­
â”‚
â”œâ”€â”€ ğŸ“‚ data/                          # Data files
â”‚   â”œâ”€â”€ course_structure.json        # Moodle course structure
â”‚   â”œâ”€â”€ cluster_profiles.json        # Cluster profiles
â”‚   â”œâ”€â”€ Po_Lo.json                   # LO â†’ Activity mappings
â”‚   â”œâ”€â”€ midterm_lo_weights.json      # Midterm LO weights
â”‚   â””â”€â”€ log/, simulated/             # Logs and simulations
â”‚
â”œâ”€â”€ ğŸ“„ api_service.py                # FastAPI service â­
â”œâ”€â”€ ğŸ“„ train_qlearning.py            # Training script â­
â”œâ”€â”€ ğŸ“„ simulate_learning_path.py     # Simulation script â­
â””â”€â”€ ğŸ“„ requirements.txt               # Dependencies
```

---

## ğŸ“ˆ Performance Metrics

### Model Performance
- **Training episodes**: 1,000+
- **Average reward**: 195.66+
- **Q-table coverage**: 18.2%+
- **State space**: 7,779+ trained states
- **Actions**: 15 action types â†’ 37 learning activities

### API Performance
- **Response time**: < 50ms
- **Success rate**: > 95%
- **Concurrent requests**: Supports multiple students

---

## ğŸ¯ State Representation

### State Vector (7D)
```python
state = (cluster_id, module_idx, progress_bin, score_bin, 
         learning_phase, engagement_level, frustration_level)
```

| Dimension | Values | Description |
|-----------|--------|-------------|
| **cluster_id** | 0-4 | Student cluster (exclude teacher) |
| **module_idx** | 0-5 | Current module index |
| **progress_bin** | 0.25, 0.5, 0.75, 1.0 | Quartile binned progress |
| **score_bin** | 0.25, 0.5, 0.75, 1.0 | Quartile binned score |
| **learning_phase** | 0, 1, 2 | pre/active/reflective |
| **engagement_level** | 0, 1, 2 | low/medium/high |
| **frustration_level** | 0 | Currently disabled |

### Action Types (15)
```python
# Past actions (5)
- view_assignment (past)
- view_content (past)
- attempt_quiz (past)
- review_quiz (past)
- post_forum (past)

# Current actions (7)
- view_assignment (current)
- view_content (current)
- submit_assignment (current)
- attempt_quiz (current)
- submit_quiz (current)
- review_quiz (current)
- post_forum (current)

# Future actions (3)
- view_content (future)
- attempt_quiz (future)
- post_forum (future)
```

---

## ğŸ’¡ Use Cases

### 1. Real-time Recommendations
```python
from services.recommendation_service import RecommendationService

service = RecommendationService(model_path='models/qtable_best.pkl')

recommendations = service.get_recommendations(
    student_id=123,
    cluster_id=2,
    current_module_id=67,
    features={
        'performance': {'module_progress': 0.75, 'avg_score': 0.85},
        'recent_action_type': 1,
        'is_stuck': False
    },
    top_k=5
)
```

### 2. Training vá»›i Detailed Logging
```bash
python3 train_qlearning.py \
    --episodes 100 \
    --detailed-logging \
    --log-interval 10
```

### 3. Learning Path Simulation
```bash
python3 simulate_learning_path.py \
    --qtable models/qtable_best.pkl \
    --students 5 \
    --steps 50 \
    --verbose
```

---

## ğŸ”§ Configuration

### config/reward_config.json
```json
{
  "reward_components": {
    "completion": {"weak": 5.0, "medium": 3.5, "strong": 2.0},
    "score_improvement": {"multiplier": 5.0},
    "high_score_bonus": {"threshold": 0.9},
    "progression": {...},
    "lo_mastery_improvement": {...}
  }
}
```

### Q-Learning Hyperparameters
```python
LEARNING_RATE = 0.1      # Î±
DISCOUNT_FACTOR = 0.95   # Î³
EPSILON = 0.1            # Îµ (exploration)
EPSILON_DECAY = 0.995
EPSILON_MIN = 0.01
```

---

## ğŸ“š Documentation

- **README.md** (this file) - Tá»•ng quan vÃ  quick start
- **ARCHITECTURE.md** - Kiáº¿n trÃºc há»‡ thá»‘ng chi tiáº¿t
- **USAGE_GUIDE.md** - API, Training, Simulation guides

---

## ğŸ› Troubleshooting

### Issue: API returns q_values=0
**Solution**: Retrain model
```bash
python3 train_qlearning.py --episodes 1000
```

### Issue: Module not found errors
**Solution**: Check course_structure.json
```bash
python3 -c "import json; print(len(json.load(open('data/course_structure.json'))['modules']))"
```

### Issue: Cluster mapping errors
**Solution**: Verify cluster_profiles.json
```bash
python3 -c "import json; print(json.load(open('data/cluster_profiles.json'))['n_clusters'])"
```

---

## ğŸ‘¥ Contributors

Developed for Adaptive Learning Research Project

## ğŸ“„ License

Internal Research Project
